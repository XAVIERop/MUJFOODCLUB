<!DOCTYPE html>
<html>
<head>
    <title>POS Dashboard Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        .log { background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 3px; font-family: monospace; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>POS Dashboard Test Suite</h1>
    
    <div class="test-section info">
        <h3>ðŸ§ª POS Dashboard Order Update Test</h3>
        <p>This page helps test if orders are being created and if the POS dashboard updates properly.</p>
    </div>

    <div class="test-section">
        <h3>1. Test Order Creation</h3>
        <p>Click the button below to create a test order and see if it appears in the POS dashboard.</p>
        <button onclick="createTestOrder()">Create Test Order</button>
        <div id="orderResult" class="log"></div>
    </div>

    <div class="test-section">
        <h3>2. Test Real-time Updates</h3>
        <p>This will test if the POS dashboard receives real-time updates when orders are created.</p>
        <button onclick="testRealtimeUpdates()">Test Real-time Updates</button>
        <div id="realtimeResult" class="log"></div>
    </div>

    <div class="test-section">
        <h3>3. Check Database Connection</h3>
        <p>Verify that the database connection is working properly.</p>
        <button onclick="testDatabaseConnection()">Test Database Connection</button>
        <div id="dbResult" class="log"></div>
    </div>

    <div class="test-section">
        <h3>4. Open POS Dashboard</h3>
        <p>Open the POS dashboard in a new tab to monitor order updates.</p>
        <button onclick="openPOSDashboard()">Open POS Dashboard</button>
    </div>

    <div class="test-section">
        <h3>ðŸ“Š Test Results</h3>
        <div id="testResults" class="log">No tests run yet.</div>
    </div>

    <script>
        let testResults = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            console.log(logMessage);
            
            testResults.push({ message: logMessage, type });
            updateTestResults();
        }

        function updateTestResults() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.textContent = testResults.map(r => r.message).join('\n');
        }

        async function createTestOrder() {
            const resultDiv = document.getElementById('orderResult');
            resultDiv.textContent = 'Creating test order...';
            
            try {
                log('Starting test order creation...');
                
                // Get a random cafe ID (you might need to update this)
                const testCafeId = 'your-cafe-id-here'; // Replace with actual cafe ID
                
                const orderData = {
                    user_id: '00000000-0000-0000-0000-000000000000', // Test user
                    cafe_id: testCafeId,
                    order_number: `TEST-${Date.now()}`,
                    total_amount: 150.00,
                    delivery_block: 'A',
                    status: 'received',
                    estimated_delivery: new Date(Date.now() + 30 * 60 * 1000).toISOString()
                };

                log(`Order data: ${JSON.stringify(orderData, null, 2)}`);

                // Note: This would need to be called from your actual app
                // since we can't directly call Supabase from this HTML file
                resultDiv.textContent = 'Test order creation requires integration with your app.\n\n' +
                    'To test properly:\n' +
                    '1. Open your app in another tab\n' +
                    '2. Place a real order\n' +
                    '3. Check if it appears in the POS dashboard\n\n' +
                    'Order data that would be created:\n' +
                    JSON.stringify(orderData, null, 2);
                
                log('Test order creation completed (simulated)');
                
            } catch (error) {
                log(`Error creating test order: ${error.message}`, 'error');
                resultDiv.textContent = `Error: ${error.message}`;
            }
        }

        async function testRealtimeUpdates() {
            const resultDiv = document.getElementById('realtimeResult');
            resultDiv.textContent = 'Testing real-time updates...';
            
            try {
                log('Testing real-time update functionality...');
                
                // This is a simulation - in reality, you'd need to:
                // 1. Set up a Supabase client
                // 2. Subscribe to order changes
                // 3. Monitor for updates
                
                resultDiv.textContent = 'Real-time update test requires integration with your app.\n\n' +
                    'To test properly:\n' +
                    '1. Open POS dashboard in one tab\n' +
                    '2. Open your app in another tab\n' +
                    '3. Place an order in the app\n' +
                    '4. Check if the POS dashboard updates automatically\n\n' +
                    'Expected behavior:\n' +
                    '- Order should appear in POS dashboard immediately\n' +
                    '- Real-time subscription should work\n' +
                    '- No manual refresh should be needed';
                
                log('Real-time update test completed (simulated)');
                
            } catch (error) {
                log(`Error testing real-time updates: ${error.message}`, 'error');
                resultDiv.textContent = `Error: ${error.message}`;
            }
        }

        async function testDatabaseConnection() {
            const resultDiv = document.getElementById('dbResult');
            resultDiv.textContent = 'Testing database connection...';
            
            try {
                log('Testing database connection...');
                
                // This is a simulation - in reality, you'd need to:
                // 1. Set up a Supabase client
                // 2. Make a test query
                // 3. Check the response
                
                resultDiv.textContent = 'Database connection test requires integration with your app.\n\n' +
                    'To test properly:\n' +
                    '1. Check browser console for any errors\n' +
                    '2. Verify Supabase configuration\n' +
                    '3. Test with a simple query\n\n' +
                    'Common issues:\n' +
                    '- Invalid Supabase URL or key\n' +
                    '- Network connectivity problems\n' +
                    '- RLS policies blocking access\n' +
                    '- Database permissions issues';
                
                log('Database connection test completed (simulated)');
                
            } catch (error) {
                log(`Error testing database connection: ${error.message}`, 'error');
                resultDiv.textContent = `Error: ${error.message}`;
            }
        }

        function openPOSDashboard() {
            log('Opening POS dashboard...');
            window.open('/pos-dashboard', '_blank');
        }

        // Initialize
        log('POS Dashboard Test Suite initialized');
        log('Ready to test order creation and dashboard updates');
    </script>
</body>
</html>
